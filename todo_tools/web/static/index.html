<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¡œğŸŒ¸å°å§</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div id="app" class="container">
        <div class="header">
            <div class="date-navigation">
                <button class="nav-button prev-day" 
                        @click="navigateDate(-1)"
                        :disabled="!hasPreviousDay">
                    <span>â†</span>
                </button>
                <input type="date" 
                       v-model="selectedDate" 
                       @change="loadDateData"
                       class="date-select"
                       :max="new Date().toISOString().split('T')[0]">
                <button class="nav-button next-day" 
                        @click="navigateDate(1)"
                        :disabled="!hasNextDay">
                    <span>â†’</span>
                </button>
            </div>
            <h1>æ¡œ-TODO</h1>
            <div class="theme-switcher">
                <button class="theme-button" 
                        :class="{ active: currentTheme === 'dark-purple' }"
                        @click="changeTheme('dark-purple')">
                    <span class="color-dot dark-purple"></span>
                </button>
                <button class="theme-button"
                        :class="{ active: currentTheme === 'light-purple' }"
                        @click="changeTheme('light-purple')">
                    <span class="color-dot light-purple"></span>
                </button>
                <button class="theme-button"
                        :class="{ active: currentTheme === 'dark-green' }"
                        @click="changeTheme('dark-green')">
                    <span class="color-dot dark-green"></span>
                </button>
                <button class="theme-button"
                        :class="{ active: currentTheme === 'light-green' }"
                        @click="changeTheme('light-green')">
                    <span class="color-dot light-green"></span>
                </button>
                <button class="theme-button"
                        :class="{ active: currentTheme === 'dark' }"
                        @click="changeTheme('dark')">
                    <span class="color-dot dark"></span>
                </button>
                <button class="theme-button"
                        :class="{ active: currentTheme === 'light' }"
                        @click="changeTheme('light')">
                    <span class="color-dot light"></span>
                </button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card glass">
                <div class="stat-title">ä»»åŠ¡å®Œæˆç‡</div>
                <div class="stat-value">{{ completionRate }}%</div>
            </div>
            <div class="stat-card glass">
                <div class="stat-title">å¹³å‡æ»¡æ„åº¦</div>
                <div class="stat-value">{{ avgSatisfaction }}â­</div>
            </div>
            <div class="stat-card glass">
                <div class="stat-title">æ—¶é—´æ•ˆç‡</div>
                <div class="stat-value">{{ timeEfficiency }}%</div>
            </div>
        </div>
        
        <div class="tabs">
            <button @click="currentView = 'todos'"
                    :class="['tab-button', currentView === 'todos' ? 'active' : '']">
                å¾…åŠäº‹é¡¹
            </button>
            <button @click="currentView = 'tasks'"
                    :class="['tab-button', currentView === 'tasks' ? 'active' : '']">
                å·²å®Œæˆä»»åŠ¡
            </button>
        </div>
        
        <div class="content-card glass" :class="{ 'edit-mode': editMode }">
            <div v-if="currentView === 'todos'" class="tasks-list">
                <div v-for="todo in sortedTodos" 
                     :key="todo.id"
                     class="task-item glass"
                     :class="{ completed: todo.status === 'completed' }"
                     @click="showTaskDetail(todo)">
                    <div class="task-header">
                        <h3>{{ todo.name }}</h3>
                        <div class="task-meta">
                            <span class="time-tag">
                                <i class="icon">â±</i>
                                {{ formatters.time(todo.time) }}
                            </span>
                            <span class="importance-tag"
                                  :style="{ color: formatters.importance(todo.importance).color }">
                                <i class="icon">ğŸ¯</i>
                                {{ formatters.importance(todo.importance).text }}
                            </span>
                            <span class="status-tag"
                                  :class="todo.status">
                                {{ todo.status === 'completed' ? 'âœ… å·²å®Œæˆ' : 'ğŸ•’ å¾…å®Œæˆ' }}
                            </span>
                        </div>
                    </div>
                    <div v-if="editingTodo === todo.id" 
                         class="edit-form"
                         @click.stop>
                        <input v-model="todo.name" 
                               class="input-field"
                               placeholder="ä»»åŠ¡åç§°"
                               @keyup.enter="saveTodo(todo)">
                        <select v-model="todo.time" class="input-field">
                            <option v-for="time in timeOptions" :value="time">
                                {{ formatters.time(time) }}
                            </option>
                        </select>
                        <select v-model="todo.importance" class="input-field">
                            <option value="low">ä½ä¼˜å…ˆçº§</option>
                            <option value="mid">ä¸­ä¼˜å…ˆçº§</option>
                            <option value="high">é«˜ä¼˜å…ˆçº§</option>
                        </select>
                        <button @click="saveTodo(todo)"
                                class="action-button save-button">
                            ä¿å­˜
                        </button>
                    </div>
                    <div class="task-actions" v-if="editMode">
                        <button @click.stop="editingTodo = todo.id"
                                class="action-button edit-button">
                            ç¼–è¾‘
                        </button>
                        <button @click.stop="deleteTodo(todo.id)"
                                class="action-button delete-button">
                            åˆ é™¤
                        </button>
                    </div>
                </div>
                <div v-if="todos.length === 0" class="empty-state">
                    æš‚æ— å¾…åŠäº‹é¡¹
                </div>
            </div>
            
            <div v-else class="tasks-list">
                <div v-for="task in tasks" 
                     :key="task.id"
                     class="task-item glass"
                     @click="showTaskDetail(task)">
                    <div class="task-header">
                        <h3>{{ task.task_name || task.name }}</h3>
                        <div class="task-meta">
                            <span class="time-range-tag">
                                <i class="icon">ğŸ•’</i>
                                {{ formatters.shortTime(task.start_time) }} ~ {{ formatters.shortTime(task.end_time) }}
                            </span>
                            <span class="time-tag">
                                <i class="icon">â±</i>
                                {{ formatters.time(task.task_len) }}
                            </span>
                            <span class="importance-tag"
                                  :style="{ color: formatters.importance(task.importance).color }">
                                <i class="icon">ğŸ¯</i>
                                {{ formatters.importance(task.importance).text }}
                            </span>
                            <span class="satisfaction-tag">
                                {{ 'â­'.repeat(task.satisfaction) }}
                            </span>
                        </div>
                    </div>
                    <div class="task-summary" v-if="task.summary">
                        <span class="summary-icon">ğŸ’­</span>
                        <span class="summary-text">{{ formatters.summary(task.summary) }}</span>
                    </div>
                    <div class="task-actions" v-if="editMode">
                        <button @click.stop="deleteTask(task.id)"
                                class="action-button delete-button">
                            åˆ é™¤
                        </button>
                    </div>
                </div>
                <div v-if="tasks.length === 0" class="empty-state">
                    æš‚æ— å·²å®Œæˆä»»åŠ¡
                </div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="chart-card glass">
                <canvas id="completionChart"></canvas>
            </div>
            <div class="chart-card glass">
                <canvas id="timeChart"></canvas>
            </div>
        </div>

        <div v-if="selectedTask" 
             class="modal-backdrop"
             @click="selectedTask = null">
            <div class="modal-content glass" 
                 @click.stop>
                <div class="modal-header">
                    <h3>ä»»åŠ¡è¯¦æƒ…</h3>
                    <button @click="selectedTask = null"
                            class="close-button">
                        Ã—
                    </button>
                </div>
                <div class="modal-body">
                    <div class="detail-item">
                        <span class="label">ä»»åŠ¡åç§°ï¼š</span>
                        <span v-text="selectedTask.task_name"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">å¼€å§‹æ—¶é—´ï¼š</span>
                        <span v-text="selectedTask.start_time"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">ç»“æŸæ—¶é—´ï¼š</span>
                        <span v-text="selectedTask.end_time"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">è®¡åˆ’æ—¶é•¿ï¼š</span>
                        <span v-text="selectedTask.planned_time"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">å®é™…æ—¶é•¿ï¼š</span>
                        <span v-text="selectedTask.task_len"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">é‡è¦æ€§ï¼š</span>
                        <span v-text="selectedTask.importance"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æ»¡æ„åº¦ï¼š</span>
                        <span v-text="'â­'.repeat(selectedTask.satisfaction)"></span>
                    </div>
                    <div class="detail-item">
                        <span class="label">æ„Ÿå—ï¼š</span>
                        <div class="feeling-text" v-text="selectedTask.feeling || 'æš‚æ— æ„Ÿå—'"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ·»åŠ ç¼–è¾‘æ¨¡å¼å¼€å…³ -->
        <button class="edit-mode-switch" 
                :class="{ active: editMode }"
                @click="toggleEditMode">
            <span v-if="editMode">å®Œæˆ</span>
            <span v-else>ç¼–è¾‘</span>
        </button>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html> 